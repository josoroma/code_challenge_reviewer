

# code_challenge_reviewer - src/review_crew.py



## Project Name: code_challenge_reviewer.

## Path: src/review_crew.py.

## Explain This: 
This code defines a class `ReviewCrew` which handles the review process for a file in a GitHub repository. The class includes methods for initializing with repository details, appending review results to a file, and running the review process using specified agents and tasks. The code also sets up logging to track the process.

## Code Review:
### Code Quality:
- The code is well-structured and organized into a class with methods that perform specific tasks.
- Logging is appropriately used to track actions and potential issues.
- Docstrings are provided for methods, which aids in understanding the purpose and functionality of each method.

### Bugs:
- There is a potential issue with the `output_placeholder.code` method, which uses 'bash' as the language. This might not correctly format the markdown result.
- The exception handling in the `run` method only prints the error. It would be better to also log these errors using the logger.

### Anti-Patterns:
- The use of `print` statements for error handling is not ideal. Itâ€™s better to use logging for consistency and better control over log levels.
- The `append_review_to_file` method creates directories and writes to files, but it doesn't handle permissions or potential I/O errors comprehensively.

### Improvements:
- Use logging instead of `print` statements for error handling.
- Validate input parameters in the `__init__` method to ensure they meet expected formats and types.
- Enhance exception handling to provide more context and use the logger for all error messages.
- Consider separating file I/O operations into a utility function or class to make the code more modular and testable.
- Improve parameter names for clarity, e.g., `output` to `output_file_path`.

### Compliance:
- The code follows PEP 8 standards for the most part but could benefit from more consistent spacing and line length adherence.
- Ensure all external dependencies (`streamlit`, `crewai`, `agents`, `tasks`) are included in a requirements file for easy setup.

## Updated Code:
```python
import os
import re
import streamlit as st
import logging
from crewai import Crew
from agents import Agents
from tasks import Tasks

# Create a custom logger
logger = logging.getLogger(__name__)
logger.setLevel(logging.DEBUG)

# Create handlers
console_handler = logging.StreamHandler()
console_handler.setLevel(logging.DEBUG)

# Create formatters and add them to the handlers
formatter = logging.Formatter('%(asctime)s - %(name)s - %(levelname)s - %(message)s')
console_handler.setFormatter(formatter)

# Add handlers to the logger
logger.addHandler(console_handler)


class ReviewCrew:
    """
    Class to handle the review process for a given file in a GitHub repository.
    """

    def __init__(self, owner, repo, path, output_file_path):
        """
        Initializes the ReviewCrew with the repository details.

        Parameters:
            owner (str): The owner of the repository.
            repo (str): The name of the repository.
            path (str): The path of the file to review.
            output_file_path (str): The path of the single file with all the repo files reviewed.
        """
        self.owner = owner
        self.repo = repo
        self.path = path
        self.output_file_path = output_file_path
        self.output_placeholder = st.empty()

    def append_review_to_file(self, result):
        """
        Appends the explain and the review result to a markdown file.

        Parameters:
            result (str): The str containing the explain and the review results in markdown format.
        """
        # Create directory path using owner and repo
        dir_path = os.path.join(self.owner, self.repo)
        os.makedirs(dir_path, exist_ok=True)

        # Create a file with the current date as its name
        file_path = os.path.join(dir_path, self.output_file_path)

        try:
            with open(file_path, 'a') as file:
                file.write(f"\n\n# {self.repo} - {self.path}\n\n")
                file.write(result)
        except Exception as e:
            logger.error(f"Error writing to file: {e}")

    def run(self):
        """
        Runs the review process using the defined agents and tasks.
        """
        try:
            # The Agents
            agents = Agents()
            review_agent = agents.review_agent()
            content_agent = agents.content_agent()

            # The Tasks
            tasks = Tasks()
            content_task = tasks.content_task(
                agent=content_agent,
                owner=self.owner,
                repo=self.repo,
                path=self.path
            )
            review_task = tasks.review_task(
                agent=review_agent,
                repo=self.repo,
                path=self.path,
                context=[content_task]
            )

            # The Crew
            crew = Crew(
                agents=[content_agent, review_agent],
                tasks=[content_task, review_task],
                verbose=2,
                telemetry=False
            )

            # Run the crew
            kickoff_result = crew.kickoff()
            
            str_result = str(kickoff_result).strip()

            result = re.sub(r'^```markdown|```$', '', str_result, flags=re.DOTALL)

            self.append_review_to_file(f"\n\n{result}\n\n")

            self.output_placeholder.code(f"\n\n{result}\n\n", language='markdown')
            
            return result

        except Exception as e:
            logger.error(f"Error running ReviewCrew: {e}")


