

# src/agents.py



my best complete final answer to the task.

## Project Name: code_challenge_reviewer.

## Path: src/agents.py.

## Explain This:
This code defines two main classes, `Agents` and `StreamToExpander`, that serve different purposes. The `Agents` class is designed to create and manage different types of agents, each with specific roles, goals, and backstories. These agents include a review agent for code reviews, a path agent for extracting file paths, and a content agent for fetching file content using GitHub's API. The `StreamToExpander` class is designed to handle output streaming to a Streamlit expander component. It cleans the data of ANSI escape codes, detects tasks, shows notifications, and streams the cleaned data to an expander.

## Code Review:
### Code Quality:
- The code is generally well-organized and follows a clear structure.
- Class and method docstrings are present, aiding in readability and maintainability.
- The logging is set up appropriately to capture errors.

### Bugs:
- No explicit bugs are found in the current code.

### Anti-Patterns:
- The `StreamToExpander` class's `write` method directly manipulates the buffer and handles multiple responsibilities. This can be broken down into smaller methods to follow the single responsibility principle.
- Hardcoded values like the list of colors in `StreamToExpander` could be made configurable.

### Improvements:
- Use more descriptive variable names. For instance, rename `self.buffer` to `self.output_buffer` for clarity.
- Break down the `write` method in `StreamToExpander` into smaller methods to improve readability.
- Consider adding type hints for method arguments and return types.
- Add unit tests for each method to ensure robustness.

### Compliance:
- The code adheres to PEP 8 standards for the most part, but some improvements can be made in terms of line length and method complexity.
- The code is compliant with general Python coding standards.

## Updated Code:
```python
import re
import logging
from crewai import Agent
import streamlit as st
from tools import Tools

# Set up logging configuration
logging.basicConfig(level=logging.ERROR, format='%(asctime)s - %(name)s - %(levelname)s - %(message)s')

class Agents:
    """
    Class to create and manage different types of agents.
    """

    REVIEW_AGENT_ROLE = 'Senior Software Developer'
    REVIEW_AGENT_GOAL = 'Perform detailed code reviews on the provided file to ensure it adheres to industry code quality standards. The code review should focus on the following aspects: evaluate code quality, identify bugs, spot anti-patterns, recommend improvements and ensure compliance.'
    REVIEW_AGENT_BACKSTORY = "You are a Senior Software Developer at a leading tech company, responsible for maintaining high code quality standards across the organization. As part of your role, you are tasked with conducting thorough code reviews on given file contents. Your goal is to ensure the code meets industry standards and follows best practices specific to the technologies in use."

    PATH_AGENT_ROLE = "File Path Extractor"
    PATH_AGENT_GOAL = "Get the tree structure of folder and return full paths of the given file or files of given folder in array format"
    PATH_AGENT_BACKSTORY = "You're a file path extractor who has created several file paths from given tree structures"

    CONTENT_AGENT_ROLE = "GitHub API Expert"
    CONTENT_AGENT_GOAL = "Get the content of given file using GitHub API"
    CONTENT_AGENT_BACKSTORY = "You're a GitHub API expert who has extracted many file contents using GitHub's API"

    def review_agent(self) -> Agent:
        """
        Creates a review agent for code reviews.

        Returns:
            Agent: Configured agent for performing code reviews.
        """
        try:
            return Agent(
                role=self.REVIEW_AGENT_ROLE,
                goal=self.REVIEW_AGENT_GOAL,
                backstory=self.REVIEW_AGENT_BACKSTORY,
                allow_delegation=False,
                verbose=True,
            )
        except Exception as e:
            logging.error("Error creating review agent", exc_info=True)
            return None

    def path_agent(self) -> Agent:
        """
        Creates a path agent for extracting file paths.

        Returns:
            Agent: Configured agent for extracting file paths.
        """
        try:
            return Agent(
                role=self.PATH_AGENT_ROLE,
                goal=self.PATH_AGENT_GOAL,
                backstory=self.PATH_AGENT_BACKSTORY,
                allow_delegation=False,
                verbose=True,
            )
        except Exception as e:
            logging.error("Error creating path agent", exc_info=True)
            return None

    def content_agent(self) -> Agent:
        """
        Creates a content agent for fetching file content using GitHub API.

        Returns:
            Agent: Configured agent for fetching file content using GitHub API.
        """
        try:
            return Agent(
                role=self.CONTENT_AGENT_ROLE,
                goal=self.CONTENT_AGENT_GOAL,
                backstory=self.CONTENT_AGENT_BACKSTORY,
                verbose=True,
                allow_delegation=False,
                tools=[Tools.get_file_contents],
            )
        except Exception as e:
            logging.error("Error creating content agent", exc_info=True)
            return None

class StreamToExpander:
    def __init__(self, expander: st.expander):
        self.expander = expander
        self.output_buffer = []
        self.colors = ['red', 'green', 'blue', 'orange']  # Define a list of colors
        self.color_index = 0  # Initialize color index

    def write(self, data: str):
        """
        Writes data to the expander after cleaning and processing.

        Args:
            data (str): The data to write.
        """
        cleaned_data = self._clean_data(data)
        task_value = self._extract_task(cleaned_data)

        if task_value:
            st.toast(":robot_face: " + task_value)

        self.output_buffer.append(cleaned_data)

        if "\n" in data:
            self._flush_buffer()

    def _clean_data(self, data: str) -> str:
        """
        Cleans the input data by removing ANSI escape codes.

        Args:
            data (str): The data to clean.

        Returns:
            str: The cleaned data.
        """
        return re.sub(r'\x1B\[[0-9;]*[mK]', '', data)

    def _extract_task(self, data: str) -> str:
        """
        Extracts the task information from the data.

        Args:
            data (str): The data from which to extract the task.

        Returns:
            str: The extracted task information.
        """
        task_match_object = re.search(r'\"task\"\s*:\s*\"(.*?)\"', data, re.IGNORECASE)
        task_match_input = re.search(r'task\s*:\s*([^\n]*)', data, re.IGNORECASE)

        if task_match_object:
            return task_match_object.group(1)
        elif task_match_input:
            return task_match_input.group(1).strip()
        return None

    def _flush_buffer(self):
        """
        Flushes the output buffer to the expander.
        """
        self.expander.code(''.join(self.output_buffer), language='bash')
        self.output_buffer = []

    def clear_buffer(self):
        """Clears the buffer to free memory."""
        self.output_buffer = []
```

This comprehensive review ensures that the code is improved in terms of readability, maintainability, and adherence to best practices.

