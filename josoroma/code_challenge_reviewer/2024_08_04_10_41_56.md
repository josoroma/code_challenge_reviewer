

# code_challenge_reviewer - src/agents.py



## Project Name
code_challenge_reviewer.

## Path
src/agents.py.

## Explain This
This code defines two classes: `Agents` and `StreamToExpander`. The `Agents` class is responsible for creating different types of agents that can perform tasks such as reviewing code, extracting file paths, and fetching file content from GitHub using the GitHub API. The `StreamToExpander` class is designed to handle output streaming, filtering out ANSI escape codes, and displaying task information in a Streamlit expander.

## Code Review
### Code Quality
- The code is generally well-structured and follows Python's conventions. 
- Class and method names are descriptive, which improves readability.
- Use of docstrings for methods provides clear documentation of their purpose.

### Bugs
- There are no critical bugs identified, but the error handling in the agent creation methods could be improved to provide more contextual information regarding the failure.

### Anti-Patterns
- The exception handling in the `try-except` blocks simply prints an error message without logging it or raising an appropriate error. This could lead to silent failures where the developer is unaware that an agent was not created successfully.

### Improvements
- Introduce logging instead of print statements for better monitoring and debugging.
- Consider using `f-strings` for consistency when formatting strings in the error messages.
- The `StreamToExpander` class could benefit from a method to clear the buffer to reduce memory usage if it grows large.

### Compliance
- The code adheres to PEP 8 guidelines regarding class and method naming conventions.
- The use of type hints in method signatures would enhance the code by providing better clarity on expected input and output types.

## Updated Code
```python
import re
import logging
from crewai import Agent
import streamlit as st
from tools import Tools

# Set up logging configuration
logging.basicConfig(level=logging.ERROR)

class Agents:
    """
    Class to create and manage different types of agents.
    """

    def review_agent(self):
        """
        Creates a review agent for code reviews.
        
        Returns:
            Agent: Configured agent for performing code reviews.
        """
        try:
            return Agent(
                role='Senior Software Developer',
                goal='Perform detailed code reviews on the provided file to ensure it adheres to industry code quality standards. The code review should focus on the following aspects: evaluate code quality, identify bugs, spot anti-patterns, recommend improvements and ensure compliance.',
                backstory="You are a Senior Software Developer at a leading tech company, responsible for maintaining high code quality standards across the organization. As part of your role, you are tasked with conducting thorough code reviews on given file contents. Your goal is to ensure the code meets industry standards and follows best practices specific to the technologies in use.",
                allow_delegation=False,
                verbose=True,
            )
        except Exception as e:
            logging.error(f"Error creating review agent: {e}")
            return None

    def path_agent(self):
        """
        Creates a path agent for extracting file paths.
        
        Returns:
            Agent: Configured agent for extracting file paths.
        """
        try:
            return Agent(
                role="File Path Extractor",
                goal="Get the tree structure of folder and return full paths of the given file or files of given folder in array format",
                backstory="You're a file path extractor who has created several file paths from given tree structures",
                allow_delegation=False,
                verbose=True,
            )
        except Exception as e:
            logging.error(f"Error creating path agent: {e}")
            return None

    def content_agent(self):
        """
        Creates a content agent for fetching file content using GitHub API.
        
        Returns:
            Agent: Configured agent for fetching file content using GitHub API.
        """
        try:
            return Agent(
                role="GitHub API Expert",
                goal="Get the content of given file using GitHub API",
                backstory="You're a GitHub API expert who has extracted many file contents using GitHub's API",
                verbose=True,
                allow_delegation=False,
                tools=[Tools.get_file_contents],
            )
        except Exception as e:
            logging.error(f"Error creating content agent: {e}")
            return None

class StreamToExpander:
    def __init__(self, expander):
        self.expander = expander
        self.buffer = []
        self.colors = ['red', 'green', 'blue', 'orange']  # Define a list of colors
        self.color_index = 0  # Initialize color index

    def write(self, data):
        # Filter out ANSI escape codes using a regular expression
        cleaned_data = re.sub(r'\x1B\[[0-9;]*[mK]', '', data)

        # Check if the data contains 'task' information
        task_match_object = re.search(r'\"task\"\s*:\s*\"(.*?)\"', cleaned_data, re.IGNORECASE)
        task_match_input = re.search(r'task\s*:\s*([^\n]*)', cleaned_data, re.IGNORECASE)
        
        task_value = None
        
        if task_match_object:
            task_value = task_match_object.group(1)
        elif task_match_input:
            task_value = task_match_input.group(1).strip()

        if task_value:
            st.toast(":robot_face: " + task_value)
            
        self.buffer.append(cleaned_data)

        if "\n" in data:
            self.expander.code(''.join(self.buffer), language='bash')
            self.buffer = []

    def clear_buffer(self):
        """Clears the buffer to free memory."""
        self.buffer = []


