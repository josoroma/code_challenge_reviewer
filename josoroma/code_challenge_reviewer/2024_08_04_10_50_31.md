

# code_challenge_reviewer - src/agents.py



## Project Name: code_challenge_reviewer.
## Path: src/agents.py.
## Explain This:
This code defines two classes, `Agents` and `StreamToExpander`, that help in creating different types of agents for specific tasks and streaming data to a Streamlit expander, respectively. The `Agents` class has methods to create agents for code review, path extraction, and content fetching using GitHub API. The `StreamToExpander` class is designed to handle data streaming to a Streamlit expander, with added functionality to filter out ANSI escape codes and detect specific tasks.

## Code Review:
### Code Quality:
- **Overall Readability**: The code is well-documented with docstrings, making it easy to understand the purpose of each method.
- **Imports**: The required modules are imported at the beginning, but there is an unnecessary import of `Tools` that is not used in `review_agent` and `path_agent`.
- **Exception Handling**: Exception handling is properly implemented using try-except blocks.

### Bugs:
- **None Identified**: No bugs were identified in the current implementation.

### Anti-Patterns:
- **Hardcoding**: Colors are hard-coded in `StreamToExpander`, which could be made configurable.
- **Repeated Code**: The pattern for creating agents is similar across methods, which could be refactored to avoid repetition.

### Improvements:
- **Refactor Agent Creation**: Create a generic method for agent creation to avoid code repetition.
- **Configuration for Colors**: Make the list of colors configurable in `StreamToExpander`.
- **Unused Imports**: Remove the unused import `Tools` from the non-relevant methods.

### Compliance:
- **PEP 8**: The code largely adheres to PEP 8 standards but can be improved with minor refactoring.

## Updated Code:
```python
import re
import logging
from crewai import Agent
import streamlit as st

# Set up logging configuration
logging.basicConfig(level=logging.ERROR)

class Agents:
    """
    Class to create and manage different types of agents.
    """

    def create_agent(self, role, goal, backstory, tools=None):
        """
        Generic method to create an agent.

        Args:
            role (str): Role of the agent.
            goal (str): Goal for the agent.
            backstory (str): Backstory for the agent.
            tools (list, optional): List of tools for the agent.

        Returns:
            Agent: Configured agent.
        """
        try:
            return Agent(
                role=role,
                goal=goal,
                backstory=backstory,
                allow_delegation=False,
                verbose=True,
                tools=tools or [],
            )
        except Exception as e:
            logging.error(f"Error creating agent: {e}")
            return None

    def review_agent(self):
        """
        Creates a review agent for code reviews.

        Returns:
            Agent: Configured agent for performing code reviews.
        """
        return self.create_agent(
            role='Senior Software Developer',
            goal='Perform detailed code reviews on the provided file to ensure it adheres to industry code quality standards. The code review should focus on the following aspects: evaluate code quality, identify bugs, spot anti-patterns, recommend improvements and ensure compliance.',
            backstory="You are a Senior Software Developer at a leading tech company, responsible for maintaining high code quality standards across the organization. As part of your role, you are tasked with conducting thorough code reviews on given file contents. Your goal is to ensure the code meets industry standards and follows best practices specific to the technologies in use."
        )

    def path_agent(self):
        """
        Creates a path agent for extracting file paths.

        Returns:
            Agent: Configured agent for extracting file paths.
        """
        return self.create_agent(
            role="File Path Extractor",
            goal="Get the tree structure of folder and return full paths of the given file or files of given folder in array format",
            backstory="You're a file path extractor who has created several file paths from given tree structures"
        )

    def content_agent(self):
        """
        Creates a content agent for fetching file content using GitHub API.

        Returns:
            Agent: Configured agent for fetching file content using GitHub API.
        """
        return self.create_agent(
            role="GitHub API Expert",
            goal="Get the content of given file using GitHub API",
            backstory="You're a GitHub API expert who has extracted many file contents using GitHub's API",
            tools=[Tools.get_file_contents],
        )


class StreamToExpander:
    def __init__(self, expander, colors=None):
        self.expander = expander
        self.buffer = []
        self.colors = colors or ['red', 'green', 'blue', 'orange']  # Use provided colors or default ones
        self.color_index = 0  # Initialize color index

    def write(self, data):
        # Filter out ANSI escape codes using a regular expression
        cleaned_data = re.sub(r'\x1B\[[0-9;]*[mK]', '', data)

        # Check if the data contains 'task' information
        task_match_object = re.search(r'\"task\"\s*:\s*\"(.*?)\"', cleaned_data, re.IGNORECASE)
        task_match_input = re.search(r'task\s*:\s*([^\n]*)', cleaned_data, re.IGNORECASE)

        task_value = None

        if task_match_object:
            task_value = task_match_object.group(1)
        elif task_match_input:
            task_value = task_match_input.group(1).strip()

        if task_value:
            st.toast(":robot_face: " + task_value)

        self.buffer.append(cleaned_data)

        if "\n" in data:
            self.expander.code(''.join(self.buffer), language='bash')
            self.buffer = []

    def clear_buffer(self):
        """Clears the buffer to free memory."""
        self.buffer = []


