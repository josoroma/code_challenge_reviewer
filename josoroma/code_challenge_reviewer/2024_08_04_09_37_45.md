

# code_challenge_reviewer - src/agents.py

## project_name
code_challenge_reviewer.
## path
src/agents.py.
## explain_this
This file defines two classes: `Agents` and `StreamToExpander`. The `Agents` class creates various types of agents for performing tasks related to code reviews, file path extraction, and content fetching from GitHub API. The `StreamToExpander` class is designed to handle output streaming, specifically filtering data and displaying task-related messages in a Streamlit application.
## code_review
1. **Code Quality**: The code is generally well-structured and follows object-oriented principles. However, there are areas where improvements can enhance readability and maintainability. 

2. **Bugs**:
   - In the `write` method of the `StreamToExpander` class, if `data` does not contain any valid task information, the method still appends `cleaned_data` to the buffer. This can lead to unnecessary data storage in the buffer.
   - The `content_agent` method lacks error handling for the case where `Tools.get_file_contents` might not be available or might throw an error.

3. **Anti-Patterns**: 
   - The use of `print` statements for error handling is an anti-pattern in production code. It's better to use logging frameworks to handle logging consistently.
   - The regular expressions used for cleaning up ANSI codes and extracting tasks could be simplified or made more robust.

4. **Improvements**: 
   - Replace `print` statements with a logging framework (e.g., Python's built-in `logging` module).
   - Implement more robust error handling around agent creation methods and ensure that the methods return meaningful error messages or handle exceptions gracefully.
   - Consider breaking down the `write` method into smaller methods for better readability and maintainability.
   - Use constants for hardcoded strings (like roles, goals, etc.) to avoid repetition and potential errors.

5. **Compliance**: The code adheres to PEP 8 style guidelines in general but could benefit from more comments in complex areas, particularly around the use of regular expressions and exception handling.

## updated_code
```python
import re
import logging
from crewai import Agent
import streamlit as st
from tools import Tools

# Configure logging
logging.basicConfig(level=logging.INFO)

class Agents:
    """
    Class to create and manage different types of agents.
    """

    def review_agent(self):
        """
        Creates a review agent for code reviews.
        
        Returns:
            Agent: Configured agent for performing code reviews.
        """
        try:
            return Agent(
                role='Senior Software Developer',
                goal='Perform detailed code reviews on the provided file to ensure it adheres to industry code quality standards. The code review should focus on the following aspects: evaluate code quality, identify bugs, spot anti-patterns, recommend improvements and ensure compliance.',
                backstory="You are a Senior Software Developer at a leading tech company, responsible for maintaining high code quality standards across the organization. As part of your role, you are tasked with conducting thorough code reviews on given file contents. Your goal is to ensure the code meets industry standards and follows best practices specific to the technologies in use.",
                allow_delegation=False,
                verbose=True,
            )
        except Exception as e:
            logging.error(f"Error creating review agent: {e}")
            return None

    def path_agent(self):
        """
        Creates a path agent for extracting file paths.
        
        Returns:
            Agent: Configured agent for extracting file paths.
        """
        try:
            return Agent(
                role="File Path Extractor",
                goal="Get the tree structure of folder and return full paths of the given file or files of given folder in array format",
                backstory="You're a file path extractor who has created several file paths from given tree structures",
                allow_delegation=False,
                verbose=True,
            )
        except Exception as e:
            logging.error(f"Error creating path agent: {e}")
            return None

    def content_agent(self):
        """
        Creates a content agent for fetching file content using GitHub API.
        
        Returns:
            Agent: Configured agent for fetching file content using GitHub API.
        """
        try:
            return Agent(
                role="GitHub API Expert",
                goal="Get the content of given file using GitHub API",
                backstory="You're a GitHub API expert who has extracted many file contents using GitHub's API",
                verbose=True,
                allow_delegation=False,
                tools=[Tools.get_file_contents],
            )
        except Exception as e:
            logging.error(f"Error creating content agent: {e}")
            return None

class StreamToExpander:
    def __init__(self, expander):
        self.expander = expander
        self.buffer = []
        self.colors = ['red', 'green', 'blue', 'orange']  # Define a list of colors
        self.color_index = 0  # Initialize color index

    def write(self, data):
        # Filter out ANSI escape codes using a regular expression
        cleaned_data = re.sub(r'\x1B\[[0-9;]*[mK]', '', data)

        # Check if the data contains 'task' information
        task_value = self.extract_task(cleaned_data)

        if task_value:
            st.toast(":robot_face: " + task_value)
            
        if "\n" in data:
            self.expander.code(''.join(self.buffer), language='bash')
            self.buffer = []

        # Only append if there's meaningful data
        if cleaned_data.strip():
            self.buffer.append(cleaned_data)

    def extract_task(self, cleaned_data):
        task_match_object = re.search(r'\"task\"\s*:\s*\"(.*?)\"', cleaned_data, re.IGNORECASE)
        task_match_input = re.search(r'task\s*:\s*([^\n]*)', cleaned_data, re.IGNORECASE)
        
        if task_match_object:
            return task_match_object.group(1)
        elif task_match_input:
            return task_match_input.group(1).strip()
        return None
```