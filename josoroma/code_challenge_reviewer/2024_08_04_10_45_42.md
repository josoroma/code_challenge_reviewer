

# code_challenge_reviewer - src/github_helper.py



## Project Name:
code_challenge_reviewer.

## Path:
src/github_helper.py.

## Explain This:
This script retrieves and displays the directory structure of a specified GitHub repository while ignoring certain directories. It uses the GitHub API to fetch the contents of the repository, relying on an environment variable for authentication. The result is formatted and displayed in a structured manner, suitable for a Streamlit application.

## Code Review:
The code presents a solid foundation for fetching and displaying the GitHub repository structure. However, there are several areas for improvement:

### Code Quality:
- The code utilizes global variables, which is generally discouraged as it can lead to issues with maintainability and readability. Consider refactoring to use function parameters or class attributes.
- The use of print statements for error handling can be replaced with logging for better tracking and debugging.

### Bugs:
- The script does not handle the case when the `GITHUB_KEY` is not set, potentially leading to unauthorized requests. Itâ€™s important to verify the presence of this key before making requests.
- The `global_path` variable is modified in a recursive manner without being properly initialized in each function call, which can lead to incorrect behavior if the function is called multiple times.

### Anti-Patterns:
- The use of `verify=False` in the requests call is a security risk, as it ignores SSL certificate verification. This should be enabled to ensure secure connections.
- The recursive function can lead to a stack overflow if the directory structure is too deep. Consider an iterative approach or limiting the depth.

### Improvements:
- Refactor the code to eliminate global variables. Use return values or encapsulate the logic in a class.
- Implement better error handling by raising exceptions or using a logging framework instead of print statements.
- Add validation for the input parameters to ensure they meet expected formats before making API calls.
- Consider using a configuration library to manage the GitHub token and other configurations instead of relying on environment variables directly.

### Compliance:
- Ensure that the code follows PEP 8 guidelines for Python code formatting. This includes naming conventions, spacing, and line lengths.
- Use type hints for function signatures to improve code clarity and facilitate static type checking.

## Updated Code:
```python
import os
import requests
import streamlit as st
import logging

# Set up logging
logging.basicConfig(level=logging.INFO)

class GitHubHelper:
    def __init__(self, owner, repo):
        self.owner = owner
        self.repo = repo
        self.global_path = ""
        self.GITHUB_KEY = os.getenv('GITHUB_KEY')
        if not self.GITHUB_KEY:
            logging.error("GITHUB_KEY environment variable is not set.")
            raise ValueError("GITHUB_KEY environment variable is required.")

    def get_file_tree(self, path="", level=0):
        """
        Fetch and print the tree structure of a GitHub repository, ignoring specific folders.

        Parameters:
        - path: The path to fetch. Leave empty to fetch the root directory.
        - level: The current depth in the tree structure.

        Returns:
        - str: The tree structure as a string.
        """
        ignore_dirs = {'public', 'images', 'media', 'assets'}
        api_url = f"https://api.github.com/repos/{self.owner}/{self.repo}/contents/{path}"
        headers = {'Authorization': f'token {self.GITHUB_KEY}'}

        try:
            response = requests.get(api_url, headers=headers, verify=True)
            response.raise_for_status()
            items = response.json()

            if isinstance(items, list):
                for item in items:
                    if item['name'] in ignore_dirs:
                        continue

                    item_name = f"{' ' * (level * 2)}- {item['name']}"
                    st.code(item_name, language='bash')
                    self.global_path += f"{item_name}\n"

                    if item['type'] == 'dir':
                        self.get_file_tree(item['path'], level + 1)

            return self.global_path

        except requests.exceptions.RequestException as e:
            logging.error(f"Request failed: {str(e)}")
            return ""
        except ValueError:
            logging.error("Error: Unable to parse the response from GitHub.")
            return ""
        except Exception as e:
            logging.error(f"An unexpected error occurred: {str(e)}")
            return ""


