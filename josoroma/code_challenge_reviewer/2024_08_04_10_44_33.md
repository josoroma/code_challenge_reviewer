

# code_challenge_reviewer - src/github_helper.py



## Project Name
code_challenge_reviewer

## Path
src/github_helper.py

## Explain This
This script fetches and prints the tree structure of a GitHub repository while ignoring specified directories. It utilizes the GitHub API to retrieve the contents of the repository and formats the output for display.

## Code Review
### Code Quality
The code is structured fairly well, with clear separation of functionality. However, there are areas for improvement, particularly in variable naming and the handling of global state. The use of a global variable (`global_path`) is not ideal as it can lead to unintended side effects.

### Bugs
1. The use of `verify=False` in the requests call is a security risk as it bypasses SSL verification. It should be set to `True` to ensure secure communication.
2. The global variable `global_path` is not thread-safe and could lead to data corruption if accessed concurrently in a web server context.

### Anti-Patterns
1. Using a global variable (`global_path`) is generally discouraged as it can lead to issues in larger codebases, especially in concurrent environments.
2. Direct printing of errors can be improved by logging them instead. This makes it easier to track issues in production.

### Improvements
1. Replace `global_path` with a local variable that is returned by the function.
2. Implement logging instead of printing for better error handling.
3. Use type hints for function parameters and return types to improve code readability and maintainability.
4. Consider handling the GitHub API rate limits and provide informative feedback to the user if limits are reached.

### Compliance
The code generally adheres to Python's PEP 8 style guidelines, but it could benefit from more comments and documentation for clarity.

## Updated Code
```python
import os
import requests
import streamlit as st
import logging

# Set up logging
logging.basicConfig(level=logging.INFO)

# Ensure environment variable is set for GITHUB_KEY
GITHUB_KEY = os.getenv('GITHUB_KEY')

def get_file_tree(owner: str, repo: str, path: str = "", level: int = 0) -> str:
    """
    Fetch and print the tree structure of a GitHub repository, ignoring specific folders.

    Parameters:
    - owner: The username of the repository owner.
    - repo: The name of the repository.
    - path: The path to fetch. Leave empty to fetch the root directory.
    - level: The current depth in the tree structure.

    Returns:
    - str: The tree structure as a string.
    """
    # Directories to ignore
    ignore_dirs = {'public', 'images', 'media', 'assets'}

    api_url = f"https://api.github.com/repos/{owner}/{repo}/contents/{path}"
    headers = {'Authorization': f'token {GITHUB_KEY}'}
    
    output = ""

    try:
        # Make the request
        response = requests.get(api_url, headers=headers, verify=True)  # Security improvement
        response.raise_for_status()
        items = response.json()

        if isinstance(items, list):
            for item in items:
                # Skip ignored directories
                if item['name'] in ignore_dirs:
                    continue

                item_name = f"{' ' * (level * 2)}- {item['name']}"
                st.code(item_name, language='bash')

                output += f"{item_name}\n"

                if item['type'] == 'dir':
                    output += get_file_tree(owner, repo, item['path'], level + 1)

        return output

    except requests.exceptions.RequestException as e:
        logging.error(f"Request error: {str(e)}")
        return ""
    except ValueError:
        logging.error("Error: Unable to parse the response from GitHub.")
        return ""
    except Exception as e:
        logging.error(f"Unexpected error occurred: {str(e)}")
        return ""


