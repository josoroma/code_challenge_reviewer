

# code_challenge_reviewer - src/agents.py



## project_name
code_challenge_reviewer.

## path
src/agents.py.

## explain_this
The `agents.py` file defines a class `Agents` for creating and managing different types of agents, such as a review agent, path agent, and content agent, each with specific goals and backstories. Additionally, it includes a `StreamToExpander` class that handles streaming output to a Streamlit expander, filtering out ANSI escape codes and displaying task information.

## code_review
The code quality in this file is generally good; however, there are several areas for improvement:

1. **Code Quality**: 
   - The code is organized into classes, which is a good practice. Each class serves a distinct purpose.
   - The use of docstrings is consistent and provides clear descriptions of the methods.

2. **Bugs**:
   - There are no critical bugs found within the code. However, the error handling in the agent creation methods could be enhanced. Instead of printing the error, consider logging it or raising a custom exception to allow for better debugging.

3. **Anti-Patterns**:
   - The use of a generic exception (`Exception`) in the `except` blocks can be improved. It is a better practice to catch specific exceptions to avoid silencing unexpected errors.
   - Using a hard-coded list of colors in the `StreamToExpander` class without any context for their use could lead to confusion. If these colors are meant for specific purposes, they should be documented or parameterized.

4. **Improvements**:
   - Consider using logging instead of print statements. This would allow for better tracking of issues in production environments.
   - The regular expression used for filtering ANSI escape codes could be compiled for performance.
   - In `StreamToExpander`, the task extraction logic can be combined into a single regex search to simplify the code.

5. **Compliance**:
   - The code adheres to PEP 8 standards for the most part, but there could be improvements in line lengths and spacing, particularly in the `Agent` instantiation arguments for readability.

## updated_code
```python
import re
import logging
from crewai import Agent
import streamlit as st
from tools import Tools

# Configure logging
logging.basicConfig(level=logging.INFO)

class Agents:
    """
    Class to create and manage different types of agents.
    """

    def review_agent(self):
        """
        Creates a review agent for code reviews.
        
        Returns:
            Agent: Configured agent for performing code reviews.
        """
        try:
            return Agent(
                role='Senior Software Developer',
                goal='Perform detailed code reviews on the provided file to ensure it adheres to industry code quality standards. The code review should focus on the following aspects: evaluate code quality, identify bugs, spot anti-patterns, recommend improvements and ensure compliance.',
                backstory="You are a Senior Software Developer at a leading tech company, responsible for maintaining high code quality standards across the organization. As part of your role, you are tasked with conducting thorough code reviews on given file contents. Your goal is to ensure the code meets industry standards and follows best practices specific to the technologies in use.",
                allow_delegation=False,
                verbose=True,
            )
        except Exception as e:
            logging.error(f"Error creating review agent: {e}")
            return None

    def path_agent(self):
        """
        Creates a path agent for extracting file paths.
        
        Returns:
            Agent: Configured agent for extracting file paths.
        """
        try:
            return Agent(
                role="File Path Extractor",
                goal="Get the tree structure of folder and return full paths of the given file or files of given folder in array format",
                backstory="You're a file path extractor who has created several file paths from given tree structures",
                allow_delegation=False,
                verbose=True,
            )
        except Exception as e:
            logging.error(f"Error creating path agent: {e}")
            return None

    def content_agent(self):
        """
        Creates a content agent for fetching file content using GitHub API.
        
        Returns:
            Agent: Configured agent for fetching file content using GitHub API.
        """
        try:
            return Agent(
                role="GitHub API Expert",
                goal="Get the content of given file using GitHub API",
                backstory="You're a GitHub API expert who has extracted many file contents using GitHub's API",
                verbose=True,
                allow_delegation=False,
                tools=[Tools.get_file_contents],
            )
        except Exception as e:
            logging.error(f"Error creating content agent: {e}")
            return None

class StreamToExpander:
    def __init__(self, expander):
        self.expander = expander
        self.buffer = []
        self.colors = ['red', 'green', 'blue', 'orange']  # Define a list of colors
        self.color_index = 0  # Initialize color index

    def write(self, data):
        # Compile regex for performance
        ansi_escape = re.compile(r'\x1B\[[0-9;]*[mK]')
        task_pattern = re.compile(r'task\s*:\s*\"?(.*?)\"?')

        # Filter out ANSI escape codes
        cleaned_data = ansi_escape.sub('', data)

        # Check if the data contains 'task' information
        task_match = task_pattern.search(cleaned_data)
        task_value = task_match.group(1).strip() if task_match else None

        if task_value:
            st.toast(":robot_face: " + task_value)

        self.buffer.append(cleaned_data)

        if "\n" in data:
            self.expander.code(''.join(self.buffer), language='bash')
            self.buffer = []
```

