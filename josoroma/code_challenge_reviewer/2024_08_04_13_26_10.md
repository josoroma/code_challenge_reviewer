

# src/agents.py



my best complete final answer to the task.

## Project Name: code_challenge_reviewer.

## Path: src/agents.py.

## Explain This:
This script defines a class `Agents` to create and manage different types of agents for various tasks like code reviews, extracting file paths, and fetching file content using GitHub API. The `StreamToExpander` class is designed to redirect output to a Streamlit expander, filtering out ANSI escape codes and displaying task information as toast notifications.

## Code Review:
### Code Quality:
1. **Readability**: The code is largely readable and well-documented with docstrings explaining the purpose and return values of methods.
2. **Modularity**: The code is modular, with different agents encapsulated in their respective methods.
3. **Logging**: Logging is used to capture errors, which improves maintainability.

### Bugs:
1. **Error Handling**: While errors are logged, the methods return `None` on failure without any further action. This might lead to silent failures if not properly handled by the caller.

### Anti-Patterns:
1. **Hardcoding**: The roles, goals, and backstories are hardcoded. Consider externalizing these to a configuration file or environment variables.
2. **Magic Numbers**: The color list and index in `StreamToExpander` could be better managed using constants or configuration.

### Improvements:
1. **Error Handling**: Instead of just logging errors, consider raising custom exceptions or handling them in a way that informs the caller of the failure.
2. **Configuration**: Externalize hardcoded strings to a configuration file.
3. **Efficiency**: The color list and index in `StreamToExpander` are not used. Remove unused variables to clean up the code.
4. **Documentation**: Add type hints to method signatures for better readability and maintenance.

### Compliance:
1. **PEP 8**: The code largely follows PEP 8 standards. However, the imports could be organized better, and there are some minor formatting issues.
2. **Best Practices**: The code adheres to many best practices such as using logging and modular design.

## Updated Code:
```python
import re
import logging
from crewai import Agent
import streamlit as st
from tools import Tools

# Set up logging configuration
logging.basicConfig(level=logging.ERROR, format='%(asctime)s - %(name)s - %(levelname)s - %(message)s')

class Agents:
    """
    Class to create and manage different types of agents.
    """

    REVIEW_AGENT_ROLE = 'Senior Software Developer'
    REVIEW_AGENT_GOAL = 'Perform detailed code reviews on the provided file to ensure it adheres to industry code quality standards. The code review should focus on the following aspects: evaluate code quality, identify bugs, spot anti-patterns, recommend improvements and ensure compliance.'
    REVIEW_AGENT_BACKSTORY = "You are a Senior Software Developer at a leading tech company, responsible for maintaining high code quality standards across the organization. As part of your role, you are tasked with conducting thorough code reviews on given file contents. Your goal is to ensure the code meets industry standards and follows best practices specific to the technologies in use."

    PATH_AGENT_ROLE = "File Path Extractor"
    PATH_AGENT_GOAL = "Get the tree structure of folder and return full paths of the given file or files of given folder in array format"
    PATH_AGENT_BACKSTORY = "You're a file path extractor who has created several file paths from given tree structures"

    CONTENT_AGENT_ROLE = "GitHub API Expert"
    CONTENT_AGENT_GOAL = "Get the content of given file using GitHub API"
    CONTENT_AGENT_BACKSTORY = "You're a GitHub API expert who has extracted many file contents using GitHub's API"

    def review_agent(self) -> Agent:
        """
        Creates a review agent for code reviews.

        Returns:
            Agent: Configured agent for performing code reviews.
        """
        try:
            return Agent(
                role=self.REVIEW_AGENT_ROLE,
                goal=self.REVIEW_AGENT_GOAL,
                backstory=self.REVIEW_AGENT_BACKSTORY,
                allow_delegation=False,
                verbose=True,
            )
        except Exception as e:
            logging.error("Error creating review agent", exc_info=True)
            raise RuntimeError("Failed to create review agent") from e

    def path_agent(self) -> Agent:
        """
        Creates a path agent for extracting file paths.

        Returns:
            Agent: Configured agent for extracting file paths.
        """
        try:
            return Agent(
                role=self.PATH_AGENT_ROLE,
                goal=self.PATH_AGENT_GOAL,
                backstory=self.PATH_AGENT_BACKSTORY,
                allow_delegation=False,
                verbose=True,
            )
        except Exception as e:
            logging.error("Error creating path agent", exc_info=True)
            raise RuntimeError("Failed to create path agent") from e

    def content_agent(self) -> Agent:
        """
        Creates a content agent for fetching file content using GitHub API.

        Returns:
            Agent: Configured agent for fetching file content using GitHub API.
        """
        try:
            return Agent(
                role=self.CONTENT_AGENT_ROLE,
                goal=self.CONTENT_AGENT_GOAL,
                backstory=self.CONTENT_AGENT_BACKSTORY,
                verbose=True,
                allow_delegation=False,
                tools=[Tools.get_file_contents],
            )
        except Exception as e:
            logging.error("Error creating content agent", exc_info=True)
            raise RuntimeError("Failed to create content agent") from e

class StreamToExpander:
    def __init__(self, expander):
        self.expander = expander
        self.buffer = []

    def write(self, data: str) -> None:
        """
        Write data to the expander, filtering out ANSI escape codes and displaying task info.
        
        Args:
            data (str): Data to write.
        """
        # Filter out ANSI escape codes using a regular expression
        cleaned_data = re.sub(r'\x1B\[[0-9;]*[mK]', '', data)

        # Check if the data contains 'task' information
        task_match_object = re.search(r'\"task\"\s*:\s*\"(.*?)\"', cleaned_data, re.IGNORECASE)
        task_match_input = re.search(r'task\s*:\s*([^\n]*)', cleaned_data, re.IGNORECASE)

        task_value = None

        if task_match_object:
            task_value = task_match_object.group(1)
        elif task_match_input:
            task_value = task_match_input.group(1).strip()

        if task_value:
            st.toast(":robot_face: " + task_value)

        self.buffer.append(cleaned_data)

        if "\n" in data:
            self.expander.code(''.join(self.buffer), language='bash')
            self.buffer = []

    def clear_buffer(self) -> None:
        """Clears the buffer to free memory."""
        self.buffer = []
```

By making these improvements, the code is now more robust, maintainable, and adheres more closely to industry best practices.



# src/constants.py



## Project Name: code_challenge_reviewer.

## Path: src/constants.py.

## Explain This:
This file defines constants that are used across the project. These constants include URLs, file paths, and directory structures relevant to the application's repository.

## Code Review:
### Code Quality:
- The code is straightforward and defines constants in an easily understandable manner.
- The naming of the constants is consistent and descriptive, which makes the code readable and maintainable.

### Bugs:
- There are no functional bugs in the code, as it is merely defining constants.

### Anti-Patterns:
- The constant `APP_REPO_PATH` is defined twice. This is redundant and can cause confusion. The second definition will overwrite the first, which might not be the intended behavior.

### Improvements:
1. Remove the duplicate definition of `APP_REPO_PATH`.
2. Ensure all constants are unique and serve a distinct purpose.
3. Consider grouping related constants together or adding comments to improve the clarity of what each constant is used for.

### Compliance:
- The code adheres to PEP 8 standards for constant naming conventions (uppercase letters with underscores).

## Updated Code:
```python
APP_REPO_URL = "https://github.com/josoroma/code_challenge_reviewer"

APP_REPO_PATH = "src/agents.py"  # Define the path to the agents.py file

APP_REPO_STRUCTURE = """
- src
  - agents.py
  - main.py
  - tools.py
"""

APP_REPO_FILE_SAMPLE = "agents.py"  # Sample file name
APP_REPO_FULLPATH_SAMPLE = "src/agents.py"  # Full path to the sample file

APP_REPO_OUTPUT = "['src/agents.py', 'src/main.py', 'tools.py']"  # List of output files


