

# code_challenge_reviewer - src/github_helper.py



## Project Name: code_challenge_reviewer

## Path: src/github_helper.py

## Explain This:
This script fetches and prints the tree structure of a GitHub repository while ignoring specific folders. It uses the GitHub API to retrieve the contents of the repository and recursively constructs a visual representation of the directory structure. It employs the `requests` library to make HTTP requests and `streamlit` to display the output in a web application. Logging is set up to capture errors and other informational messages.

## Code Review:

### Code Quality:
- The code is generally well-structured and easy to read with appropriate comments explaining the functionality.
- The usage of type hints for function parameters and return values is good practice and enhances readability.
- The logging setup is straightforward and appropriate for capturing errors.

### Bugs:
- There are no apparent bugs in the code. However, the functionality is highly dependent on the `GITHUB_KEY` environment variable, which should be checked for existence before making API requests.

### Anti-Patterns:
- The use of a recursive function `get_file_tree` is appropriate but could lead to deep recursion issues for very large repositories.
- The `st.code` function is called within the loop, which might not be the best practice for large outputs.

### Improvements:
1. **Environment Variable Check:**
   - Ensure that the `GITHUB_KEY` is available at the start of the script and handle cases where it might be missing.
2. **Error Handling:**
   - Add more specific exception handling for different types of request errors.
3. **Recursion Depth:**
   - Although not critical, consider adding a maximum depth to prevent potential stack overflow issues with deeply nested directories.
4. **Optimized Output:**
   - Collect all output and display it once to reduce potential performance issues with `streamlit`.

### Compliance:
- The script complies with standard Python practices and uses libraries appropriately.
- Security is considered by verifying SSL certificates in `requests`.

## Updated Code:
```python
import os
import requests
import streamlit as st
import logging

# Set up logging
logging.basicConfig(level=logging.INFO)

# Ensure environment variable is set for GITHUB_KEY
GITHUB_KEY = os.getenv('GITHUB_KEY')
if not GITHUB_KEY:
    logging.error("GITHUB_KEY environment variable not set.")
    raise ValueError("GITHUB_KEY environment variable not set.")

def get_file_tree(owner: str, repo: str, path: str = "", level: int = 0, max_depth: int = 10) -> str:
    """
    Fetch and print the tree structure of a GitHub repository, ignoring specific folders.

    Parameters:
    - owner: The username of the repository owner.
    - repo: The name of the repository.
    - path: The path to fetch. Leave empty to fetch the root directory.
    - level: The current depth in the tree structure.
    - max_depth: The maximum depth to recurse into directories.

    Returns:
    - str: The tree structure as a string.
    """
    # Directories to ignore
    ignore_dirs = {'public', 'images', 'media', 'assets'}

    if level > max_depth:
        return ""

    api_url = f"https://api.github.com/repos/{owner}/{repo}/contents/{path}"
    headers = {'Authorization': f'token {GITHUB_KEY}'}

    output = ""

    try:
        # Make the request
        response = requests.get(api_url, headers=headers, verify=True)
        response.raise_for_status()
        items = response.json()

        if isinstance(items, list):
            for item in items:
                # Skip ignored directories
                if item['name'] in ignore_dirs:
                    continue

                item_name = f"{' ' * (level * 2)}- {item['name']}"
                output += f"{item_name}\n"

                if item['type'] == 'dir':
                    output += get_file_tree(owner, repo, item['path'], level + 1, max_depth)

        return output

    except requests.exceptions.HTTPError as http_err:
        logging.error(f"HTTP error occurred: {http_err}")
        return ""
    except requests.exceptions.ConnectionError as conn_err:
        logging.error(f"Connection error occurred: {conn_err}")
        return ""
    except requests.exceptions.Timeout as timeout_err:
        logging.error(f"Timeout error occurred: {timeout_err}")
        return ""
    except requests.exceptions.RequestException as req_err:
        logging.error(f"Request error: {req_err}")
        return ""
    except ValueError:
        logging.error("Error: Unable to parse the response from GitHub.")
        return ""
    except Exception as e:
        logging.error(f"Unexpected error occurred: {str(e)}")
        return ""

if __name__ == "__main__":
    owner = "octocat"
    repo = "Hello-World"
    tree_structure = get_file_tree(owner, repo)
    st.code(tree_structure, language='bash')
```

This updated code adds checks for the `GITHUB_KEY` environment variable, enhances error handling, and introduces a maximum recursion depth to prevent potential stack overflow issues. Additionally, it moves the `streamlit` display to the main block to optimize performance.

