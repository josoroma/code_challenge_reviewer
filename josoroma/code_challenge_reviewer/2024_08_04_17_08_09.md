

# src/agents.py



my best complete final answer to the task.


## Project Name: code_challenge_reviewer
## Path: src/agents.py

## Explain This:
The `agents.py` file defines a class `Agents` that creates and manages different types of agents, each with specific roles, goals, and backstories. The file also includes a `StreamToExpander` class that processes and displays logs in a Streamlit expander, filtering out ANSI escape codes and displaying task information as Toast notifications.

## Code Review:
### Code Quality:
The overall code quality is good. The code is well-structured, and docstrings are provided for methods, which enhance readability and maintainability.

### Bugs:
- No explicit bugs were identified in the current implementation.

### Anti-Patterns:
1. **Exception Handling Anti-Pattern:**
   - Current exception handling only logs errors but does not provide any mechanism for recovery or user notification.
   - **Improvement:** Consider providing user feedback or alternative actions when exceptions occur.

2. **Magic Numbers and Strings:**
   - The list of colors and the initial color index in `StreamToExpander` are hardcoded.
   - **Improvement:** Use constants for these values to improve code readability and maintainability.

### Improvements:
1. **Logging Configuration:**
   - The logging configuration is set to `ERROR`. For development and debugging purposes, it may be beneficial to allow configurable logging levels.

2. **Docstrings Enhancement:**
   - Provide more detailed docstrings, including parameter descriptions and types for each method.

3. **Dependency Injection:**
   - The `Tools.get_file_contents` dependency is directly referenced within `content_agent`. It could be better to inject this dependency to allow for easier testing and mocking.

4. **Buffer Handling:**
   - The buffer handling in `StreamToExpander` could be further optimized to handle large data more efficiently.

### Compliance:
- The code follows PEP 8 standards for Python coding style.
- The use of docstrings is consistent with Python documentation practices.

## Updated Code:
```python
import re
import logging
from crewai import Agent
import streamlit as st
from tools import Tools

# Set up logging configuration
LOGGING_LEVEL = logging.ERROR  # Can be set to DEBUG for development purposes
logging.basicConfig(level=LOGGING_LEVEL, format='%(asctime)s - %(name)s - %(levelname)s - %(message)s')

class Agents:
    """
    Class to create and manage different types of agents.
    """

    REVIEW_AGENT_ROLE = 'Senior Software Developer'
    REVIEW_AGENT_GOAL = 'Perform detailed code reviews on the provided file to ensure it adheres to industry code quality standards. The code review should focus on the following aspects: evaluate code quality, identify bugs, spot anti-patterns, recommend improvements and ensure compliance.'
    REVIEW_AGENT_BACKSTORY = "You are a Senior Software Developer at a leading tech company, responsible for maintaining high code quality standards across the organization. As part of your role, you are tasked with conducting thorough code reviews on given file contents. Your goal is to ensure the code meets industry standards and follows best practices specific to the technologies in use."

    PATH_AGENT_ROLE = "File Path Extractor"
    PATH_AGENT_GOAL = "Get the tree structure of folder and return full paths of the given file or files of given folder in array format"
    PATH_AGENT_BACKSTORY = "You're a file path extractor who has created several file paths from given tree structures"

    CONTENT_AGENT_ROLE = "GitHub API Expert"
    CONTENT_AGENT_GOAL = "Get the content of given file using GitHub API"
    CONTENT_AGENT_BACKSTORY = "You're a GitHub API expert who has extracted many file contents using GitHub's API"

    def review_agent(self):
        """
        Creates a review agent for code reviews.

        Returns:
            Agent: Configured agent for performing code reviews.
        """
        try:
            return Agent(
                role=self.REVIEW_AGENT_ROLE,
                goal=self.REVIEW_AGENT_GOAL,
                backstory=self.REVIEW_AGENT_BACKSTORY,
                allow_delegation=False,
                verbose=True,
            )
        except Exception as e:
            logging.error("Error creating review agent", exc_info=True)
            return None

    def path_agent(self):
        """
        Creates a path agent for extracting file paths.

        Returns:
            Agent: Configured agent for extracting file paths.
        """
        try:
            return Agent(
                role=self.PATH_AGENT_ROLE,
                goal=self.PATH_AGENT_GOAL,
                backstory=self.PATH_AGENT_BACKSTORY,
                allow_delegation=False,
                verbose=True,
            )
        except Exception as e:
            logging.error("Error creating path agent", exc_info=True)
            return None

    def content_agent(self):
        """
        Creates a content agent for fetching file content using GitHub API.

        Returns:
            Agent: Configured agent for fetching file content using GitHub API.
        """
        try:
            return Agent(
                role=self.CONTENT_AGENT_ROLE,
                goal=self.CONTENT_AGENT_GOAL,
                backstory=self.CONTENT_AGENT_BACKSTORY,
                verbose=True,
                allow_delegation=False,
                tools=[Tools.get_file_contents],
            )
        except Exception as e:
            logging.error("Error creating content agent", exc_info=True)
            return None

class StreamToExpander:
    COLOR_LIST = ['red', 'green', 'blue', 'orange']  # Define a list of colors
    INITIAL_COLOR_INDEX = 0  # Initialize color index

    def __init__(self, expander):
        """
        Initializes the StreamToExpander with a Streamlit expander.

        Args:
            expander (Expander): The Streamlit expander to output logs.
        """
        self.expander = expander
        self.buffer = []
        self.colors = self.COLOR_LIST
        self.color_index = self.INITIAL_COLOR_INDEX

    def write(self, data):
        """
        Writes data to the Streamlit expander.

        Filters out ANSI escape codes and displays task information as Toast notifications.

        Args:
            data (str): The data to be written.
        """
        # Filter out ANSI escape codes using a regular expression
        cleaned_data = re.sub(r'\x1B\[[0-9;]*[mK]', '', data)

        # Check if the data contains 'task' information
        task_match_object = re.search(r'\"task\"\s*:\s*\"(.*?)\"', cleaned_data, re.IGNORECASE)
        task_match_input = re.search(r'task\s*:\s*([^\n]*)', cleaned_data, re.IGNORECASE)

        task_value = None

        if task_match_object:
            task_value = task_match_object.group(1)
        elif task_match_input:
            task_value = task_match_input.group(1).strip()

        if task_value:
            st.toast(":robot_face: " + task_value)

        self.buffer.append(cleaned_data)

        if "\n" in data:
            self.expander.code(''.join(self.buffer), language='bash')
            self.buffer = []

    def clear_buffer(self):
        """Clears the buffer to free memory."""
        self.buffer = []
```



